{% extends 'base.html' %}

{% block title %}Cadastro de Funcionário - AutoEscola{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center py-12 px-4 bg-gray-50">
    <div class="max-w-4xl w-full">
        <!-- Cabeçalho -->
        <div class="text-center mb-12">
            <div class="w-16 h-16 mx-auto rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 flex items-center justify-center shadow-glow mb-6">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-3">Cadastro de Funcionário</h1>
            <p class="text-gray-600 max-w-md mx-auto">Preencha todos os campos para se cadastrar como funcionário administrativo</p>
        </div>

        <!-- Formulário -->
        <div class="bg-white rounded-2xl shadow-card p-8">
            <!-- Mensagens de erro -->
            {% if messages %}
            <div class="mb-6 space-y-2">
                {% for message in messages %}
                <div class="p-4 rounded-lg {% if message.tags == 'error' %}bg-red-50 text-red-700 border border-red-200{% else %}bg-green-50 text-green-700 border border-green-200{% endif %}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <form method="post" enctype="multipart/form-data" id="employeeForm">
                {% csrf_token %}
                
                <!-- Campo oculto para role -->
                <input type="hidden" name="role" value="funcionario">

                <!-- Seção 1: Dados de Acesso -->
                <div class="mb-8">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center mr-3">
                            <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </div>
                        <h2 class="text-xl font-bold text-gray-900">Dados de Acesso</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Nome de Usuário -->
                        <div>
                            <label for="id_username" class="block text-sm font-medium text-gray-700 mb-2">
                                Nome de Usuário *
                            </label>
                            <input type="text" 
                                   name="username" 
                                   id="id_username" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                   placeholder="escolha_um_usuario">
                            {% if form.username.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.username.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Email -->
                        <div>
                            <label for="id_email" class="block text-sm font-medium text-gray-700 mb-2">
                                Email *
                            </label>
                            <input type="email" 
                                   name="email" 
                                   id="id_email" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                   placeholder="seu@email.com">
                            {% if form.email.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Senha -->
                        <div>
                            <label for="id_password1" class="block text-sm font-medium text-gray-700 mb-2">
                                Senha *
                            </label>
                            <input type="password" 
                                   name="password1" 
                                   id="id_password1" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                   placeholder="••••••••">
                            {% if form.password1.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.password1.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Confirmar Senha -->
                        <div>
                            <label for="id_password2" class="block text-sm font-medium text-gray-700 mb-2">
                                Confirmar Senha *
                            </label>
                            <input type="password" 
                                   name="password2" 
                                   id="id_password2" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                   placeholder="••••••••">
                            {% if form.password2.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.password2.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Seção 2: Dados Pessoais -->
                <div class="mb-8">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center mr-3">
                            <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <h2 class="text-xl font-bold text-gray-900">Dados Pessoais</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Nome Completo -->
                        <div class="md:col-span-2">
                            <label for="id_full_name" class="block text-sm font-medium text-gray-700 mb-2">
                                Nome Completo *
                            </label>
                            <input type="text" 
                                   name="full_name" 
                                   id="id_full_name" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                   placeholder="Seu nome completo">
                        </div>

                        <!-- CPF -->
                        <div>
                            <label for="id_cpf" class="block text-sm font-medium text-gray-700 mb-2">
                                CPF *
                            </label>
                            <input type="text" 
                                   name="cpf" 
                                   id="id_cpf" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                   placeholder="000.000.000-00"
                                   maxlength="14">
                            <div class="mt-1 flex justify-between">
                                <span class="text-sm text-gray-500">Digite 11 dígitos</span>
                                <span id="cpfCounter" class="text-sm text-gray-500">(0/11)</span>
                            </div>
                        </div>

                        <!-- RG -->
                        <div>
                            <label for="id_rg" class="block text-sm font-medium text-gray-700 mb-2">
                                RG *
                            </label>
                            <input type="text" 
                                   name="rg" 
                                   id="id_rg" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                   placeholder="00.000.000-0"
                                   maxlength="20">
                            <div class="mt-1 flex justify-between">
                                <span class="text-sm text-gray-500">8-12 caracteres</span>
                                <span id="rgCounter" class="text-sm text-gray-500">(0 caracteres)</span>
                            </div>
                        </div>

                        <!-- Telefone -->
                        <div>
                            <label for="id_phone" class="block text-sm font-medium text-gray-700 mb-2">
                                Telefone *
                            </label>
                            <input type="tel" 
                                   name="phone" 
                                   id="id_phone" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                   placeholder="(00) 00000-0000">
                        </div>

                        <!-- Data de Nascimento -->
                        <div>
                            <label for="id_birth_date" class="block text-sm font-medium text-gray-700 mb-2">
                                Data de Nascimento *
                            </label>
                            <input type="date" 
                                   name="birth_date" 
                                   id="id_birth_date" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
                        </div>
                    </div>
                </div>

                <!-- Seção 3: Endereço -->
                <div class="mb-8">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center mr-3">
                            <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        </div>
                        <h2 class="text-xl font-bold text-gray-900">Endereço</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- CEP -->
                        <div>
                            <label for="id_cep" class="block text-sm font-medium text-gray-700 mb-2">
                                CEP *
                            </label>
                            <input type="text" 
                                   name="cep" 
                                   id="id_cep" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                   placeholder="00000-000"
                                   maxlength="9">
                            <div class="mt-1 flex justify-between">
                                <span class="text-sm text-gray-500">Digite 8 dígitos</span>
                                <span id="cepCounter" class="text-sm text-gray-500">(0/8)</span>
                            </div>
                        </div>

                        <!-- Endereço (auto preenchido) -->
                        <div class="md:col-span-2">
                            <label for="id_address" class="block text-sm font-medium text-gray-700 mb-2">
                                Endereço *
                            </label>
                            <input type="text" 
                                   name="address" 
                                   id="id_address" 
                                   required
                                   readonly
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-gray-50 cursor-not-allowed transition-all">
                            <p class="mt-1 text-sm text-gray-500">Preenchido automaticamente</p>
                        </div>

                        <!-- Número e Complemento -->
                        <div>
                            <label for="id_address_number" class="block text-sm font-medium text-gray-700 mb-2">
                                Número *
                            </label>
                            <input type="text" 
                                   name="address_number" 
                                   id="id_address_number" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
                        </div>

                        <div>
                            <label for="id_address_complement" class="block text-sm font-medium text-gray-700 mb-2">
                                Complemento
                            </label>
                            <input type="text" 
                                   name="address_complement" 
                                   id="id_address_complement"
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
                        </div>
                    </div>
                </div>

                <!-- Seção 4: Informações Profissionais -->
                <div class="mb-8">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center mr-3">
                            <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <h2 class="text-xl font-bold text-gray-900">Informações Profissionais</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Área de Atuação -->
                        <div>
                            <label for="id_department" class="block text-sm font-medium text-gray-700 mb-2">
                                Departamento *
                            </label>
                            <select name="department" 
                                    id="id_department" 
                                    required
                                    class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
                                <option value="">Selecione um departamento</option>
                                <option value="secretaria">Secretaria</option>
                                <option value="financeiro">Financeiro</option>
                                <option value="atendimento">Atendimento</option>
                                <option value="administrativo">Administrativo</option>
                                <option value="rh">Recursos Humanos</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>

                        <!-- Cargo -->
                        <div>
                            <label for="id_position" class="block text-sm font-medium text-gray-700 mb-2">
                                Cargo *
                            </label>
                            <input type="text" 
                                   name="position" 
                                   id="id_position" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                   placeholder="Seu cargo">
                        </div>
                    </div>
                </div>

                <!-- Seção 5: Documentos -->
                <div class="mb-8">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center mr-3">
                            <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <h2 class="text-xl font-bold text-gray-900">Documentos</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Foto 3x4 -->
                        <div>
                            <label for="id_photo" class="block text-sm font-medium text-gray-700 mb-2">
                                Foto 3x4 *
                            </label>
                            <input type="file" 
                                   name="photo" 
                                   id="id_photo" 
                                   required
                                   accept=".jpg,.jpeg,.png,image/jpeg,image/png"
                                   class="w-full px-4 py-3 rounded-lg border-2 border-dashed border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
                            <p class="mt-1 text-sm text-gray-500">Apenas JPG, JPEG ou PNG (máx. 5MB)</p>
                        </div>

                        <!-- Documentos de Suporte (Opcionais) -->
                        <div>
                            <label for="id_support_document_1" class="block text-sm font-medium text-gray-700 mb-2">
                                Documento de Suporte 1
                            </label>
                            <input type="file" 
                                   name="support_document_1" 
                                   id="id_support_document_1"
                                   accept="image/*,.pdf,.doc,.docx"
                                   class="w-full px-4 py-3 rounded-lg border-2 border-dashed border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
                            <p class="mt-1 text-sm text-gray-500">Comprovante de residência, etc.</p>
                        </div>

                        <div>
                            <label for="id_support_document_2" class="block text-sm font-medium text-gray-700 mb-2">
                                Documento de Suporte 2
                            </label>
                            <input type="file" 
                                   name="support_document_2" 
                                   id="id_support_document_2"
                                   accept="image/*,.pdf,.doc,.docx"
                                   class="w-full px-4 py-3 rounded-lg border-2 border-dashed border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
                            <p class="mt-1 text-sm text-gray-500">Certificado de curso, etc.</p>
                        </div>
                    </div>
                </div>

                <!-- Termos e Condições -->
                <div class="mb-8 p-4 bg-gray-50 rounded-xl">
                    <div class="flex items-start">
                        <input type="checkbox" 
                               name="terms" 
                               id="id_terms" 
                               required
                               class="mt-1 mr-3 w-5 h-5 text-purple-600 rounded focus:ring-purple-500">
                        <label for="id_terms" class="text-sm text-gray-700">
                            Declaro que todas as informações fornecidas são verdadeiras e
                            concordo com os <a href="#" class="text-purple-600 hover:underline">termos de uso</a>
                            e <a href="#" class="text-purple-600 hover:underline">política de privacidade</a>
                            da auto escola.
                        </label>
                    </div>
                    {% if form.terms.errors %}
                    <p class="mt-2 text-sm text-red-600">{{ form.terms.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Botões -->
                <div class="flex flex-col sm:flex-row gap-4 justify-between">
                    <a href="{% url 'choice' %}" 
                       class="px-6 py-3 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-all text-center">
                        Voltar
                    </a>
                    <button type="submit" 
                            class="px-8 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white font-medium rounded-lg hover:opacity-90 transition-all shadow-card">
                        Finalizar Cadastro
                    </button>
                </div>

                <!-- Link para Login -->
                <div class="mt-8 pt-6 border-t border-gray-200 text-center">
                    <p class="text-gray-600">
                        Já tem uma conta? 
                        <a href="{% url 'login' %}" class="text-purple-600 font-medium hover:underline">
                            Faça login aqui
                        </a>
                    </p>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // ============================================
    // 1. MÁSCARA PARA CPF
    // ============================================
    const cpfInput = document.getElementById('id_cpf');
    if (cpfInput) {
        cpfInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            
            // Aplica formatação
            if (value.length > 9) {
                e.target.value = value.replace(/(\d{3})(\d{3})(\d{3})(\d)/, '$1.$2.$3-$4');
            } else if (value.length > 6) {
                e.target.value = value.replace(/(\d{3})(\d{3})(\d)/, '$1.$2.$3');
            } else if (value.length > 3) {
                e.target.value = value.replace(/(\d{3})(\d)/, '$1.$2');
            } else {
                e.target.value = value;
            }
            
            // Atualiza contador
            const counter = document.getElementById('cpfCounter');
            if (counter) {
                const digits = e.target.value.replace(/\D/g, '');
                counter.textContent = `(${digits.length}/11)`;
                counter.className = `text-sm ${digits.length === 11 ? 'text-green-600' : 'text-red-600'}`;
            }
        });
    }
    
    // ============================================
    // 2. MÁSCARA PARA RG
    // ============================================
    const rgInput = document.getElementById('id_rg');
    if (rgInput) {
        rgInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^A-Za-z0-9.-]/g, '');
            if (value.length > 20) value = value.substring(0, 20);
            
            const cleanValue = value.replace(/[^A-Za-z0-9]/g, '');
            
            // Aplica formatação baseada no tipo
            if (cleanValue.length === 0) {
                e.target.value = value;
            } else if (/^[A-Za-z]{2}/.test(cleanValue)) {
                // Padrão com letras (ex: MG-12.345.678)
                if (cleanValue.length <= 2) {
                    e.target.value = cleanValue;
                } else if (cleanValue.length <= 4) {
                    e.target.value = cleanValue.replace(/([A-Za-z]{2})(\d)/, '$1-$2');
                } else if (cleanValue.length <= 7) {
                    e.target.value = cleanValue.replace(/([A-Za-z]{2})(\d{2})(\d)/, '$1-$2.$3');
                } else if (cleanValue.length <= 10) {
                    e.target.value = cleanValue.replace(/([A-Za-z]{2})(\d{2})(\d{3})(\d)/, '$1-$2.$3.$4');
                } else {
                    e.target.value = cleanValue.replace(/([A-Za-z]{2})(\d{2})(\d{3})(\d{3})/, '$1-$2.$3.$4');
                }
            } else if (/^\d+$/.test(cleanValue)) {
                // Padrão apenas números (ex: 12.345.678-9)
                if (cleanValue.length <= 2) {
                    e.target.value = cleanValue;
                } else if (cleanValue.length <= 5) {
                    e.target.value = cleanValue.replace(/(\d{2})(\d)/, '$1.$2');
                } else if (cleanValue.length <= 8) {
                    e.target.value = cleanValue.replace(/(\d{2})(\d{3})(\d)/, '$1.$2.$3');
                } else {
                    e.target.value = cleanValue.replace(/(\d{2})(\d{3})(\d{3})(\d)/, '$1.$2.$3-$4');
                }
            } else {
                e.target.value = value;
            }
            
            // Atualiza contador
            const counter = document.getElementById('rgCounter');
            if (counter) {
                const alphanum = e.target.value.replace(/[^A-Za-z0-9]/g, '');
                counter.textContent = `(${alphanum.length} caracteres)`;
                counter.className = `text-sm ${alphanum.length >= 8 && alphanum.length <= 12 ? 'text-green-600' : 'text-red-600'}`;
            }
        });
    }
    
    // ============================================
    // 3. MÁSCARA PARA CEP
    // ============================================
    const cepInput = document.getElementById('id_cep');
    const addressInput = document.getElementById('id_address');
    
    if (cepInput) {
        cepInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 8) value = value.substring(0, 8);
            
            if (value.length > 5) {
                e.target.value = value.replace(/(\d{5})(\d)/, '$1-$2');
            } else {
                e.target.value = value;
            }
            
            // Atualiza contador
            const counter = document.getElementById('cepCounter');
            if (counter) {
                const digits = e.target.value.replace(/\D/g, '');
                counter.textContent = `(${digits.length}/8)`;
                counter.className = `text-sm ${digits.length === 8 ? 'text-green-600' : 'text-red-600'}`;
            }
        });
        
        // Busca automática de CEP
        cepInput.addEventListener('blur', async function() {
            const digits = this.value.replace(/\D/g, '');
            
            if (digits.length === 8 && addressInput) {
                try {
                    // Adiciona indicador de carregamento
                    this.classList.add('bg-gray-100');
                    
                    const response = await fetch(`https://viacep.com.br/ws/${digits}/json/`);
                    const data = await response.json();
                    
                    if (!data.erro) {
                        // Formata o endereço
                        const formattedAddress = `${data.logradouro || ''}, ${data.bairro || ''}, ${data.localidade || ''} - ${data.uf || ''}`;
                        addressInput.value = formattedAddress.trim();
                        
                        // Remove readonly e permite edição
                        addressInput.readOnly = false;
                        addressInput.classList.remove('bg-gray-50', 'cursor-not-allowed');
                        addressInput.classList.add('bg-white', 'cursor-text');
                        
                        // Adiciona borda de sucesso
                        this.classList.remove('border-gray-300');
                        this.classList.add('border-green-500');
                        
                    } else {
                        throw new Error('CEP não encontrado');
                    }
                } catch (error) {
                    console.error('Erro ao buscar CEP:', error);
                    
                    // Adiciona borda de erro
                    this.classList.remove('border-gray-300');
                    this.classList.add('border-red-500');
                    
                    // Mantém campo de endereço vazio mas editável
                    addressInput.value = '';
                    addressInput.readOnly = false;
                    addressInput.classList.remove('bg-gray-50', 'cursor-not-allowed');
                    addressInput.classList.add('bg-white', 'cursor-text');
                    addressInput.placeholder = 'Digite o endereço manualmente';
                } finally {
                    this.classList.remove('bg-gray-100');
                }
            }
        });
    }
    
    // ============================================
    // 4. MÁSCARA PARA TELEFONE
    // ============================================
    const phoneInput = document.getElementById('id_phone');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            
            if (value.length <= 10) {
                if (value.length > 6) {
                    e.target.value = value.replace(/(\d{2})(\d{4})(\d)/, '($1) $2-$3');
                } else if (value.length > 2) {
                    e.target.value = value.replace(/(\d{2})(\d)/, '($1) $2');
                } else {
                    e.target.value = value;
                }
            } else {
                e.target.value = value.replace(/(\d{2})(\d{5})(\d)/, '($1) $2-$3');
            }
        });
    }
    
    // ============================================
    // 5. VALIDAÇÃO DE FORMULÁRIO
    // ============================================
    const form = document.getElementById('employeeForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            let isValid = true;
            
            // Valida CPF
            if (cpfInput) {
                const cpfDigits = cpfInput.value.replace(/\D/g, '');
                if (cpfDigits.length !== 11) {
                    cpfInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    cpfInput.classList.remove('border-red-500');
                }
            }
            
            // Valida RG
            if (rgInput) {
                const rgAlphanum = rgInput.value.replace(/[^A-Za-z0-9]/g, '');
                if (rgAlphanum.length < 8 || rgAlphanum.length > 12) {
                    rgInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    rgInput.classList.remove('border-red-500');
                }
            }
            
            // Valida CEP
            if (cepInput) {
                const cepDigits = cepInput.value.replace(/\D/g, '');
                if (cepDigits.length !== 8) {
                    cepInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    cepInput.classList.remove('border-red-500');
                }
            }
            
            // Valida Telefone
            if (phoneInput) {
                const phoneDigits = phoneInput.value.replace(/\D/g, '');
                if (phoneDigits.length < 10) {
                    phoneInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    phoneInput.classList.remove('border-red-500');
                }
            }
            
            // Valida Foto
            const photoInput = document.getElementById('id_photo');
            if (photoInput && !photoInput.files.length) {
                photoInput.classList.add('border-red-500');
                isValid = false;
            } else if (photoInput) {
                photoInput.classList.remove('border-red-500');
            }
            
            // Valida Departamento
            const departmentSelect = document.getElementById('id_department');
            if (departmentSelect && !departmentSelect.value) {
                departmentSelect.classList.add('border-red-500');
                isValid = false;
            } else if (departmentSelect) {
                departmentSelect.classList.remove('border-red-500');
            }
            
            // Valida Cargo
            const positionInput = document.getElementById('id_position');
            if (positionInput && !positionInput.value.trim()) {
                positionInput.classList.add('border-red-500');
                isValid = false;
            } else if (positionInput) {
                positionInput.classList.remove('border-red-500');
            }
            
            // Valida Termos
            const termsCheckbox = document.getElementById('id_terms');
            if (termsCheckbox && !termsCheckbox.checked) {
                const termsLabel = termsCheckbox.nextElementSibling;
                if (termsLabel) {
                    termsLabel.classList.add('text-red-600');
                }
                isValid = false;
            }
            
            if (!isValid) {
                e.preventDefault();
                
                // Rola para o primeiro erro
                const firstError = document.querySelector('.border-red-500, .text-red-600');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstError.focus();
                }
                
                alert('Por favor, corrija os campos destacados em vermelho.');
            }
        });
        
        // Remove validação ao digitar
        const allInputs = [cpfInput, rgInput, cepInput, phoneInput, positionInput];
        allInputs.forEach(input => {
            if (input) {
                input.addEventListener('input', function() {
                    this.classList.remove('border-red-500');
                });
            }
        });
        
        // Remove validação do select
        if (departmentSelect) {
            departmentSelect.addEventListener('change', function() {
                this.classList.remove('border-red-500');
            });
        }
        
        // Remove validação da foto ao selecionar
        if (photoInput) {
            photoInput.addEventListener('change', function() {
                this.classList.remove('border-red-500');
            });
        }
        
        // Remove validação dos termos
        if (termsCheckbox) {
            termsCheckbox.addEventListener('change', function() {
                const termsLabel = this.nextElementSibling;
                if (termsLabel) {
                    termsLabel.classList.remove('text-red-600');
                }
            });
        }
    }
    
 });
</script>
{% endblock %}