{% extends 'base.html' %}

{% block title %}Cadastro de Instrutor - AutoEscola{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 pt-20 pb-12">
    <div class="container mx-auto px-4 max-w-5xl">
        <!-- Cabeçalho -->
        <div class="text-center mb-12 animate-fade-in">
            <div class="w-16 h-16 mx-auto rounded-2xl bg-gradient-to-br from-yellow-500 via-amber-500 to-orange-500 flex items-center justify-center shadow-glow mb-6">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Cadastro de Instrutor</h1>
            <p class="text-gray-600 max-w-2xl mx-auto">Visual alinhado ao agendamento, com cartões, ícones e destaques em amarelo.</p>
        </div>

        <!-- Formulário -->
        <div class="bg-white rounded-2xl shadow-card p-8 space-y-8">
            <!-- Mensagens de erro -->
            {% if messages %}
            <div class="mb-6 space-y-2">
                {% for message in messages %}
                <div class="p-4 rounded-lg {% if message.tags == 'error' %}bg-red-50 text-red-700 border border-red-200{% else %}bg-green-50 text-green-700 border border-green-200{% endif %}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <form method="post" enctype="multipart/form-data" id="instructorForm">
                {% csrf_token %}
                
                <!-- Campo oculto para role -->
                <input type="hidden" name="role" value="instrutor">

                <!-- Seção 1: Dados de Acesso -->
                <div class="mb-6 rounded-xl border border-yellow-200 bg-amber-50/70 p-6 shadow-inner">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-white shadow-card flex items-center justify-center">
                                <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-xs font-semibold uppercase text-amber-700">Passo 1</p>
                                <h2 class="text-xl font-bold text-gray-900">Dados de Acesso</h2>
                            </div>
                        </div>
                        <span class="text-xs font-medium text-amber-700 bg-amber-100 px-3 py-1 rounded-full">Seguro e privado</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Nome de Usuário -->
                        <div>
                            <label for="id_username" class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                <svg class="h-4 w-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.655 6.879 1.804M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Nome de Usuário *
                            </label>
                            <input type="text" 
                                   name="username" 
                                   value="{{ form.username.value|default:'' }}"
                                   id="id_username" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="escolha_um_usuario">
                            {% if form.username.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.username.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Email -->
                        <div>
                            <label for="id_email" class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                <svg class="h-4 w-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12H8m8-4H8m2 8h8M4 6h16a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2z"></path>
                                </svg>
                                Email *
                            </label>
                            <input type="email" 
                                   name="email" 
                                   value="{{ form.email.value|default:'' }}"
                                   id="id_email" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="seu@email.com">
                            {% if form.email.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Senha -->
                        <div>
                            <label for="id_password1" class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                <svg class="h-4 w-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c1.657 0 3-1.343 3-3V7a3 3 0 00-6 0v1c0 1.657 1.343 3 3 3zm6 0a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2v-6a2 2 0 012-2h12z"></path>
                                </svg>
                                Senha *
                            </label>
                            <input type="password" 
                                   name="password1" 
                                   id="id_password1" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="••••••••">
                            {% if form.password1.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.password1.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Confirmar Senha -->
                        <div>
                            <label for="id_password2" class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                <svg class="h-4 w-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c1.657 0 3-1.343 3-3V7a3 3 0 00-6 0v1c0 1.657 1.343 3 3 3zm6 0a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2v-6a2 2 0 012-2h12z"></path>
                                </svg>
                                Confirmar Senha *
                            </label>
                            <input type="password" 
                                   name="password2" 
                                   id="id_password2" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="••••••••">
                            {% if form.password2.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.password2.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Seção 2: Dados Pessoais -->
                <div class="mb-6 rounded-xl border border-yellow-200 bg-amber-50/70 p-6 shadow-inner">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-lg bg-white shadow-card flex items-center justify-center">
                            <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs font-semibold uppercase text-amber-700">Passo 2</p>
                            <h2 class="text-xl font-bold text-gray-900">Dados Pessoais</h2>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Nome Completo -->
                        <div class="md:col-span-2">
                            <label for="id_full_name" class="block text-sm font-medium text-gray-700 mb-2">Nome Completo *</label>
                            <input type="text" 
                                   name="full_name" 
                                   value="{{ form.full_name.value|default:'' }}"
                                   id="id_full_name" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="Seu nome completo">
                        </div>

                        <!-- CPF -->
                        <div>
                            <label for="id_cpf" class="block text-sm font-medium text-gray-700 mb-2">CPF *</label>
                            <input type="text" 
                                   name="cpf" 
                                   value="{{ form.cpf.value|default:'' }}"
                                   id="id_cpf" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="000.000.000-00"
                                   maxlength="14">
                            <div class="mt-1 flex justify-between text-sm text-gray-600">
                                <span>Digite 11 dígitos</span>
                                <span id="cpfCounter" class="font-medium text-amber-700">(0/11)</span>
                            </div>
                        </div>

                        <!-- RG -->
                        <div>
                            <label for="id_rg" class="block text-sm font-medium text-gray-700 mb-2">RG *</label>
                            <input type="text" 
                                   name="rg" 
                                   value="{{ form.rg.value|default:'' }}"
                                   id="id_rg" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="00.000.000-0"
                                   maxlength="20">
                            <div class="mt-1 flex justify-between text-sm text-gray-600">
                                <span>8-12 caracteres</span>
                                <span id="rgCounter" class="font-medium text-amber-700">(0 caracteres)</span>
                            </div>
                        </div>

                        <!-- Telefone -->
                        <div>
                            <label for="id_phone" class="block text-sm font-medium text-gray-700 mb-2">Telefone *</label>
                            <input type="tel" 
                                   name="phone" 
                                   value="{{ form.phone.value|default:'' }}"
                                   id="id_phone" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="(00) 00000-0000">
                        </div>

                        <!-- Data de Nascimento -->
                        <div>
                            <label for="id_birth_date" class="block text-sm font-medium text-gray-700 mb-2">Data de Nascimento *</label>
                            <input type="date" 
                                   name="birth_date" 
                                   value="{{ form.birth_date.value|default:'' }}"
                                   id="id_birth_date" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                        </div>

                        <!-- Identidade de Gênero -->
                        <div>
                            <label for="id_gender_identity" class="block text-sm font-medium text-gray-700 mb-2">Identidade de Gênero *</label>
                            <select name="gender_identity" id="id_gender_identity" required class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                                <option value="">Selecione</option>
                                <option value="CF" {% if form.gender_identity.value == 'CF' %}selected{% endif %}>Cisgênero Feminino</option>
                                <option value="CM" {% if form.gender_identity.value == 'CM' %}selected{% endif %}>Cisgênero Masculino</option>
                                <option value="TM" {% if form.gender_identity.value == 'TM' %}selected{% endif %}>Homem Transgênero</option>
                                <option value="TW" {% if form.gender_identity.value == 'TW' %}selected{% endif %}>Mulher Transgênero</option>
                            </select>
                            {% if form.gender_identity.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.gender_identity.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Seção 3: Endereço -->
                <div class="mb-6 rounded-xl border border-yellow-200 bg-amber-50/70 p-6 shadow-inner">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-lg bg-white shadow-card flex items-center justify-center">
                            <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs font-semibold uppercase text-amber-700">Passo 3</p>
                            <h2 class="text-xl font-bold text-gray-900">Endereço</h2>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- CEP -->
                        <div>
                            <label for="id_cep" class="block text-sm font-medium text-gray-700 mb-2">CEP *</label>
                            <input type="text" 
                                   name="cep" 
                                   value="{{ form.cep.value|default:'' }}"
                                   id="id_cep" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="00000-000"
                                   maxlength="9">
                            <div class="mt-1 flex justify-between text-sm text-gray-600">
                                <span>Digite 8 dígitos</span>
                                <span id="cepCounter" class="font-medium text-amber-700">(0/8)</span>
                            </div>
                        </div>

                        <!-- Endereço (auto preenchido) -->
                        <div class="md:col-span-2">
                            <label for="id_address" class="block text-sm font-medium text-gray-700 mb-2">Endereço *</label>
                            <input type="text" 
                                   name="address" 
                                   id="id_address" 
                                   required
                                   readonly
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white/70 cursor-not-allowed transition-all">
                            <p class="mt-1 text-sm text-gray-600">Preenchido automaticamente após CEP ou editável se necessário.</p>
                        </div>

                        <!-- Número e Complemento -->
                        <div>
                            <label for="id_address_number" class="block text-sm font-medium text-gray-700 mb-2">Número *</label>
                            <input type="text" 
                                   name="address_number" 
                                   value="{{ form.address_number.value|default:'' }}"
                                   id="id_address_number" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                        </div>

                        <div>
                            <label for="id_address_complement" class="block text-sm font-medium text-gray-700 mb-2">Complemento</label>
                            <input type="text" 
                                   name="address_complement" 
                                   value="{{ form.id_address_complement.value|default:'' }}"
                                   id="id_address_complement"
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                        </div>

                        <!-- CEP da Base/Garagem -->
                        <div class="md:col-span-2">
                            <label for="id_cep_base" class="block text-sm font-medium text-gray-700 mb-2">CEP da Base/Garagem (local de início das aulas)</label>
                            <input type="text" 
                                   name="cep_base" 
                                   value="{{ form.cep_base.value|default:'' }}"
                                   id="id_cep_base" 
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="00000-000" maxlength="9">
                            <p class="mt-1 text-sm text-gray-600">Ajuda a encontrar alunos próximos. Opcional.</p>
                            {% if form.cep_base.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.cep_base.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Seção 4: Documentos -->
                <div class="mb-6 rounded-xl border border-yellow-200 bg-amber-50/70 p-6 shadow-inner">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-lg bg-white shadow-card flex items-center justify-center">
                            <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs font-semibold uppercase text-amber-700">Passo 4</p>
                            <h2 class="text-xl font-bold text-gray-900">Documentos Profissionais</h2>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- CNH -->
                        <div>
                            <label for="id_cnh" class="block text-sm font-medium text-gray-700 mb-2">Número da CNH *</label>
                            <input type="text" 
                                   name="cnh" 
                                   id="id_cnh" 
                                   value="{{ form.cnh.value|default:'' }}"
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="Digite o número da CNH">
                            <p class="mt-1 text-sm text-gray-600">Mínimo 9 dígitos</p>
                        </div>

                        <!-- Data de Emissão da CNH -->
                        <div>
                            <label for="id_cnh_emission_date" class="block text-sm font-medium text-gray-700 mb-2">Data de Emissão da CNH *</label>
                            <input type="date" 
                                   name="cnh_emission_date" 
                                   value="{{ form.cnh_emission_date.value|default:'' }}"
                                   id="id_cnh_emission_date" 
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                        </div>

                        <!-- Credencial -->
                        <div>
                            <label for="id_credential" class="block text-sm font-medium text-gray-700 mb-2">Credencial de Instrutor *</label>
                            <input type="text" 
                                   name="credential" 
                                   id="id_credential" 
                                   value="{{ form.credential.value|default:'' }}"
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="Número da credencial">
                            <p class="mt-1 text-sm text-gray-600">Mínimo 5 caracteres</p>
                        </div>

                        <!-- Foto 3x4 -->
                        <div>
                            <label for="id_photo" class="block text-sm font-medium text-gray-700 mb-2">Foto 3x4 *</label>
                            <input type="file" 
                                   name="photo" 
                                   id="id_photo" 
                                   required
                                   accept="image/*"
                                   class="w-full px-4 py-3 rounded-lg border-2 border-dashed border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                            <p class="mt-1 text-sm text-gray-600">JPG, PNG (máx. 5MB)</p>
                        </div>

                        <!-- Documento da CNH -->
                        <div>
                            <label for="id_cnh_document" class="block text-sm font-medium text-gray-700 mb-2">CNH (Frente e Verso) *</label>
                            <input type="file" 
                                   name="cnh_document" 
                                   id="id_cnh_document" 
                                   required
                                   accept="image/*,.pdf"
                                   class="w-full px-4 py-3 rounded-lg border-2 border-dashed border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                            <p class="mt-1 text-sm text-gray-600">JPG, PNG ou PDF (máx. 10MB)</p>
                        </div>

                        <!-- Documentos de Suporte -->
                        <div>
                            <label for="id_support_document_1" class="block text-sm font-medium text-gray-700 mb-2">Documento de Suporte 1</label>
                            <input type="file" 
                                   name="support_document_1" 
                                   id="id_support_document_1"
                                   accept="image/*,.pdf,.doc,.docx"
                                   class="w-full px-4 py-3 rounded-lg border-2 border-dashed border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                        </div>

                        <div>
                            <label for="id_support_document_2" class="block text-sm font-medium text-gray-700 mb-2">Documento de Suporte 2</label>
                            <input type="file" 
                                   name="support_document_2" 
                                   id="id_support_document_2"
                                   accept="image/*,.pdf,.doc,.docx"
                                   class="w-full px-4 py-3 rounded-lg border-2 border-dashed border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                        </div>
                    </div>
                </div>

                <!-- Seção 5: Veículo do Instrutor -->
                <div class="mb-6 rounded-xl border border-yellow-200 bg-amber-50/70 p-6 shadow-inner">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-lg bg-white shadow-card flex items-center justify-center">
                            <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 13l2-2m0 0l7-7 7 7M5 11v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6" />
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs font-semibold uppercase text-amber-700">Passo 5</p>
                            <h2 class="text-xl font-bold text-gray-900">Veículo do Instrutor</h2>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Placa -->
                        <div>
                            <label for="id_vehicle_plate" class="block text-sm font-medium text-gray-700 mb-2">Placa do Veículo *</label>
                            <input type="text"
                                   name="vehicle_plate"
                                   id="id_vehicle_plate"
                                   value="{{ form.vehicle_plate.value|default:'' }}"
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="ABC1D23 ou AAA-1234"
                                   maxlength="8">
                            <p class="mt-1 text-sm text-gray-600">Formatos aceitos: ABC1D23 ou AAA-1234</p>
                        </div>

                        <!-- RENAVAM -->
                        <div>
                            <label for="id_vehicle_renavam" class="block text-sm font-medium text-gray-700 mb-2">RENAVAM *</label>
                            <input type="text"
                                   name="vehicle_renavam"
                                   id="id_vehicle_renavam"
                                   value="{{ form.vehicle_renavam.value|default:'' }}"
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="11 dígitos"
                                   maxlength="11">
                            <div class="mt-1 flex justify-between text-sm text-gray-600">
                                <span>Digite 11 dígitos</span>
                                <span id="renavamCounter" class="font-medium text-amber-700">(0/11)</span>
                            </div>
                        </div>

                        <!-- Marca -->
                        <div>
                            <label for="id_vehicle_make" class="block text-sm font-medium text-gray-700 mb-2">Marca *</label>
                            <input type="text"
                                   name="vehicle_make"
                                   id="id_vehicle_make"
                                   value="{{ form.vehicle_make.value|default:'' }}"
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="Ex.: Chevrolet">
                        </div>

                        <!-- Modelo -->
                        <div>
                            <label for="id_vehicle_model" class="block text-sm font-medium text-gray-700 mb-2">Modelo *</label>
                            <input type="text"
                                   name="vehicle_model"
                                   id="id_vehicle_model"
                                   value="{{ form.vehicle_model.value|default:'' }}"
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="Ex.: Onix 1.0">
                        </div>

                        <!-- Cor -->
                        <div>
                            <label for="id_vehicle_color" class="block text-sm font-medium text-gray-700 mb-2">Cor *</label>
                            <input type="text"
                                   name="vehicle_color"
                                   id="id_vehicle_color"
                                   value="{{ form.vehicle_color.value|default:'' }}"
                                   required
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="Ex.: Prata">
                        </div>

                        <!-- Ano -->
                        <div>
                            <label for="id_vehicle_year" class="block text-sm font-medium text-gray-700 mb-2">Ano *</label>
                            <input type="number"
                                   name="vehicle_year"
                                   id="id_vehicle_year"
                                   value="{{ form.vehicle_year.value|default:'' }}"
                                   required
                                   min="1960"
                                   class="w-full px-4 py-3 rounded-lg border border-amber-200 bg-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                   placeholder="Ex.: 2022">
                        </div>

                        <!-- Acionamento duplo -->
                        <div class="md:col-span-2">
                            <label class="inline-flex items-center">
                                <input type="checkbox" name="vehicle_dual_control" id="id_vehicle_dual_control" class="w-5 h-5 text-yellow-600 rounded focus:ring-yellow-500" {% if form.vehicle_dual_control.value %}checked{% endif %}>
                                <span class="ml-3 text-gray-700">Possui acionamento duplo (pedais no passageiro)</span>
                            </label>
                        </div>

                        <!-- Adaptado para PCD -->
                        <div class="md:col-span-2">
                            <label class="inline-flex items-center">
                                <input type="checkbox" name="vehicle_adapted_pcd" id="id_vehicle_adapted_pcd" class="w-5 h-5 text-yellow-600 rounded focus:ring-yellow-500" {% if form.vehicle_adapted_pcd.value %}checked{% endif %}>
                                <span class="ml-3 text-gray-700">Veículo adaptado para PCD</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Termos e Condições -->
                <div class="mb-6 p-5 rounded-xl border border-yellow-200 bg-amber-50/70 shadow-inner">
                    <div class="flex items-start gap-3">
                        <div class="w-10 h-10 rounded-lg bg-white shadow-card flex items-center justify-center">
                            <svg class="h-5 w-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <label for="id_terms" class="flex items-start gap-3 text-sm text-gray-700">
                                <input type="checkbox" 
                                       name="terms" 
                                       id="id_terms" 
                                       required
                                       class="mt-1 w-5 h-5 text-yellow-600 rounded focus:ring-yellow-500">
                                <span>Declaro que todas as informações fornecidas são verdadeiras e concordo com os <a href="#" class="text-amber-700 font-medium hover:underline">termos de uso</a> e <a href="#" class="text-amber-700 font-medium hover:underline">política de privacidade</a> da auto escola.</span>
                            </label>
                            {% if form.terms.errors %}
                            <p class="mt-2 text-sm text-red-600">{{ form.terms.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Botões -->
                <div class="flex flex-col sm:flex-row gap-4 justify-between items-center">
                    <a href="{% url 'choice' %}" 
                       class="w-full sm:w-auto px-6 py-3 rounded-lg border border-amber-100 text-amber-800 font-medium bg-white hover:bg-amber-50 transition-all text-center shadow-card">
                        Voltar
                    </a>
                    <button type="submit" 
                            class="w-full sm:w-auto px-8 py-3 bg-gradient-to-r from-yellow-500 via-amber-500 to-orange-500 text-white font-medium rounded-lg hover:opacity-90 transition-all shadow-card">
                        Finalizar Cadastro
                    </button>
                </div>

                <!-- Link para Login -->
                <div class="mt-8 pt-6 border-t border-gray-200 text-center">
                    <p class="text-gray-600">
                        Já tem uma conta? 
                        <a href="{% url 'login' %}" class="text-yellow-600 font-medium hover:underline">
                            Faça login aqui
                        </a>
                    </p>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // ============================================
    // 1. MÁSCARA PARA CPF
    // ============================================
    const cpfInput = document.getElementById('id_cpf');
    if (cpfInput) {
        cpfInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            
            // Aplica formatação
            if (value.length > 9) {
                e.target.value = value.replace(/(\d{3})(\d{3})(\d{3})(\d)/, '$1.$2.$3-$4');
            } else if (value.length > 6) {
                e.target.value = value.replace(/(\d{3})(\d{3})(\d)/, '$1.$2.$3');
            } else if (value.length > 3) {
                e.target.value = value.replace(/(\d{3})(\d)/, '$1.$2');
            } else {
                e.target.value = value;
            }
            
            // Atualiza contador
            const counter = document.getElementById('cpfCounter');
            if (counter) {
                const digits = e.target.value.replace(/\D/g, '');
                counter.textContent = `(${digits.length}/11)`;
                counter.className = `text-sm ${digits.length === 11 ? 'text-green-600' : 'text-red-600'}`;
            }
        });
    }
    
    // ============================================
    // 2. MÁSCARA PARA RG
    // ============================================
    const rgInput = document.getElementById('id_rg');
    if (rgInput) {
        rgInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^A-Za-z0-9.-]/g, '');
            if (value.length > 20) value = value.substring(0, 20);
            
            const cleanValue = value.replace(/[^A-Za-z0-9]/g, '');
            
            // Aplica formatação baseada no tipo
            if (cleanValue.length === 0) {
                e.target.value = value;
            } else if (/^[A-Za-z]{2}/.test(cleanValue)) {
                // Padrão com letras (ex: MG-12.345.678)
                if (cleanValue.length <= 2) {
                    e.target.value = cleanValue;
                } else if (cleanValue.length <= 4) {
                    e.target.value = cleanValue.replace(/([A-Za-z]{2})(\d)/, '$1-$2');
                } else if (cleanValue.length <= 7) {
                    e.target.value = cleanValue.replace(/([A-Za-z]{2})(\d{2})(\d)/, '$1-$2.$3');
                } else if (cleanValue.length <= 10) {
                    e.target.value = cleanValue.replace(/([A-Za-z]{2})(\d{2})(\d{3})(\d)/, '$1-$2.$3.$4');
                } else {
                    e.target.value = cleanValue.replace(/([A-Za-z]{2})(\d{2})(\d{3})(\d{3})/, '$1-$2.$3.$4');
                }
            } else if (/^\d+$/.test(cleanValue)) {
                // Padrão apenas números (ex: 12.345.678-9)
                if (cleanValue.length <= 2) {
                    e.target.value = cleanValue;
                } else if (cleanValue.length <= 5) {
                    e.target.value = cleanValue.replace(/(\d{2})(\d)/, '$1.$2');
                } else if (cleanValue.length <= 8) {
                    e.target.value = cleanValue.replace(/(\d{2})(\d{3})(\d)/, '$1.$2.$3');
                } else {
                    e.target.value = cleanValue.replace(/(\d{2})(\d{3})(\d{3})(\d)/, '$1.$2.$3-$4');
                }
            } else {
                e.target.value = value;
            }
            
            // Atualiza contador
            const counter = document.getElementById('rgCounter');
            if (counter) {
                const alphanum = e.target.value.replace(/[^A-Za-z0-9]/g, '');
                counter.textContent = `(${alphanum.length} caracteres)`;
                counter.className = `text-sm ${alphanum.length >= 8 && alphanum.length <= 12 ? 'text-green-600' : 'text-red-600'}`;
            }
        });
    }
    
    // ============================================
    // 3. MÁSCARA PARA CEP
    // ============================================
    const cepInput = document.getElementById('id_cep');
    const addressInput = document.getElementById('id_address');
    const cepBaseInput = document.getElementById('id_cep_base');
    
    if (cepInput) {
        cepInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 8) value = value.substring(0, 8);
            
            if (value.length > 5) {
                e.target.value = value.replace(/(\d{5})(\d)/, '$1-$2');
            } else {
                e.target.value = value;
            }
            
            // Atualiza contador
            const counter = document.getElementById('cepCounter');
            if (counter) {
                const digits = e.target.value.replace(/\D/g, '');
                counter.textContent = `(${digits.length}/8)`;
                counter.className = `text-sm ${digits.length === 8 ? 'text-green-600' : 'text-red-600'}`;
            }
        });
        
        // Busca automática de CEP
        cepInput.addEventListener('blur', async function() {
            const digits = this.value.replace(/\D/g, '');
            
            if (digits.length === 8 && addressInput) {
                try {
                    // Adiciona indicador de carregamento
                    this.classList.add('bg-gray-100');
                    
                    const response = await fetch(`https://viacep.com.br/ws/${digits}/json/`);
                    const data = await response.json();
                    
                    if (!data.erro) {
                        // Formata o endereço
                        const formattedAddress = `${data.logradouro || ''}, ${data.bairro || ''}, ${data.localidade || ''} - ${data.uf || ''}`;
                        addressInput.value = formattedAddress.trim();
                        
                        // Remove readonly e permite edição
                        addressInput.readOnly = false;
                        addressInput.classList.remove('bg-gray-50', 'cursor-not-allowed');
                        addressInput.classList.add('bg-white', 'cursor-text');
                        
                        // Adiciona borda de sucesso
                        this.classList.remove('border-gray-300');
                        this.classList.add('border-green-500');
                        
                    } else {
                        throw new Error('CEP não encontrado');
                    }
                } catch (error) {
                    console.error('Erro ao buscar CEP:', error);
                    
                    // Adiciona borda de erro
                    this.classList.remove('border-gray-300');
                    this.classList.add('border-red-500');
                    
                    // Mantém campo de endereço vazio mas editável
                    addressInput.value = '';
                    addressInput.readOnly = false;
                    addressInput.classList.remove('bg-gray-50', 'cursor-not-allowed');
                    addressInput.classList.add('bg-white', 'cursor-text');
                    addressInput.placeholder = 'Digite o endereço manualmente';
                } finally {
                    this.classList.remove('bg-gray-100');
                }
            }
        });
    }
    
    // ============================================
    // 4. MÁSCARA PARA TELEFONE
    // ============================================
    const phoneInput = document.getElementById('id_phone');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            
            if (value.length <= 10) {
                if (value.length > 6) {
                    e.target.value = value.replace(/(\d{2})(\d{4})(\d)/, '($1) $2-$3');
                } else if (value.length > 2) {
                    e.target.value = value.replace(/(\d{2})(\d)/, '($1) $2');
                } else {
                    e.target.value = value;
                }
            } else {
                e.target.value = value.replace(/(\d{2})(\d{5})(\d)/, '($1) $2-$3');
            }
        });
    }
    
    // ============================================
    // 5. MÁSCARA PARA CNH (somente números)
    // ============================================
    const cnhInput = document.getElementById('id_cnh');
    if (cnhInput) {
        cnhInput.addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '');
        });
    }
    
    // ============================================
    // 6. MÁSCARA PARA CREDENCIAL (letras e números)
    // ============================================
    const credentialInput = document.getElementById('id_credential');
    if (credentialInput) {
        credentialInput.addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^A-Za-z0-9]/g, '');
        });
    }
    
    // ============================================
    // 7. MÁSCARAS PARA VEÍCULO
    // ============================================
    const plateInput = document.getElementById('id_vehicle_plate');
    if (plateInput) {
        plateInput.addEventListener('input', function(e) {
            e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9-]/g, '');
        });
    }

    // Máscara para CEP da Base
    if (cepBaseInput) {
        cepBaseInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 8) value = value.substring(0, 8);
            if (value.length > 5) {
                e.target.value = value.replace(/(\d{5})(\d)/, '$1-$2');
            } else {
                e.target.value = value;
            }
        });
    }

    const renavamInput = document.getElementById('id_vehicle_renavam');
    if (renavamInput) {
        renavamInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            e.target.value = value;
            const counter = document.getElementById('renavamCounter');
            if (counter) {
                counter.textContent = `(${value.length}/11)`;
                counter.className = `text-sm ${value.length === 11 ? 'text-green-600' : 'text-gray-500'}`;
            }
        });
    }

    const yearInput = document.getElementById('id_vehicle_year');
    if (yearInput) {
        yearInput.addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
        });
    }

    // ============================================
    // 8. VALIDAÇÃO DE FORMULÁRIO
    // ============================================
    const form = document.getElementById('instructorForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            let isValid = true;
            
            // Valida CPF
            if (cpfInput) {
                const cpfDigits = cpfInput.value.replace(/\D/g, '');
                if (cpfDigits.length !== 11) {
                    cpfInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    cpfInput.classList.remove('border-red-500');
                }
            }
            
            // Valida RG
            if (rgInput) {
                const rgAlphanum = rgInput.value.replace(/[^A-Za-z0-9]/g, '');
                if (rgAlphanum.length < 8 || rgAlphanum.length > 12) {
                    rgInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    rgInput.classList.remove('border-red-500');
                }
            }
            
            // Valida CEP
            if (cepInput) {
                const cepDigits = cepInput.value.replace(/\D/g, '');
                if (cepDigits.length !== 8) {
                    cepInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    cepInput.classList.remove('border-red-500');
                }
            }
            
            // Valida Telefone
            if (phoneInput) {
                const phoneDigits = phoneInput.value.replace(/\D/g, '');
                if (phoneDigits.length < 10) {
                    phoneInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    phoneInput.classList.remove('border-red-500');
                }
            }
            
            // Valida CNH
            if (cnhInput) {
                const cnhDigits = cnhInput.value.replace(/\D/g, '');
                if (cnhDigits.length < 9) {
                    cnhInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    cnhInput.classList.remove('border-red-500');
                }
            }
            
            // Valida Credencial
            if (credentialInput) {
                const credentialAlphanum = credentialInput.value.replace(/[^A-Za-z0-9]/g, '');
                if (credentialAlphanum.length < 5) {
                    credentialInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    credentialInput.classList.remove('border-red-500');
                }
            }
            
            // Valida Termos
            const termsCheckbox = document.getElementById('id_terms');
            if (termsCheckbox && !termsCheckbox.checked) {
                const termsLabel = termsCheckbox.nextElementSibling;
                if (termsLabel) {
                    termsLabel.classList.add('text-red-600');
                }
                isValid = false;
            }
            
            // Valida Placa
            if (plateInput) {
                const plate = plateInput.value.toUpperCase();
                const old = /^[A-Z]{3}-?\d{4}$/;
                const merc = /^[A-Z]{3}-?[0-9][A-Z][0-9]{2}$/;
                if (!(old.test(plate) || merc.test(plate))) {
                    plateInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    plateInput.classList.remove('border-red-500');
                }
            }

            // Valida RENAVAM
            if (renavamInput) {
                const digits = renavamInput.value.replace(/\D/g, '');
                if (digits.length !== 11) {
                    renavamInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    renavamInput.classList.remove('border-red-500');
                }
            }

            // Valida Ano
            if (yearInput) {
                const y = parseInt(yearInput.value, 10);
                const now = new Date().getFullYear();
                if (!y || y < 1960 || y > (now + 1)) {
                    yearInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    yearInput.classList.remove('border-red-500');
                }
            }

            if (!isValid) {
                e.preventDefault();
                
                // Rola para o primeiro erro
                const firstError = document.querySelector('.border-red-500, .text-red-600');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstError.focus();
                }
                
                alert('Por favor, corrija os campos destacados em vermelho.');
            }
        });
        
        // Remove validação ao digitar
        const allInputs = [cpfInput, rgInput, cepInput, phoneInput, cnhInput, credentialInput];
        allInputs.forEach(input => {
            if (input) {
                input.addEventListener('input', function() {
                    this.classList.remove('border-red-500');
                });
            }
        });
        
        // Remove validação dos termos
        const termsCheckbox = document.getElementById('id_terms');
        if (termsCheckbox) {
            termsCheckbox.addEventListener('change', function() {
                const termsLabel = this.nextElementSibling;
                if (termsLabel) {
 termsLabel.classList.remove('text-red-600');
                }
            });
        }
    }
    
});
// ============================================
    // 5. VALIDAÇÃO DE IDADE MÍNIMA (18 anos)
    // ============================================
    const birthDateInput = document.getElementById('id_birth_date');
    if (birthDateInput) {
        birthDateInput.addEventListener('change', function() {
            if (this.value) {
                const birthDate = new Date(this.value);
                const today = new Date();
                const age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                const actualAge = (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) 
                    ? age - 1 
                    : age;
                
                // Valida se é maior de 18 anos
                if (actualAge >= 18) {
                    this.classList.remove('border-red-500');
                    this.classList.add('border-green-500');
                    
                    // Remove mensagem de erro se existir
                    const errorMsg = this.parentNode.querySelector('.age-error');
                    if (errorMsg) errorMsg.remove();
                } else {
                    this.classList.remove('border-green-500');
                    this.classList.add('border-red-500');
                    
                    // Adiciona mensagem de erro
                    let errorMsg = this.parentNode.querySelector('.age-error');
                    if (!errorMsg) {
                        errorMsg = document.createElement('p');
                        errorMsg.className = 'mt-1 text-sm text-red-600 age-error';
                        this.parentNode.appendChild(errorMsg);
                    }
                    errorMsg.textContent = `Idade mínima de 18 anos. Você tem ${actualAge} anos.`;
                }
            }
        });
    }
    
</script>
{% endblock %}